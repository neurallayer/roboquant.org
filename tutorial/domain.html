<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="roboquant algo-trading framework" />
    <meta name="keywords" content="trading Kotlin algo roboquant">
    <meta name="theme-color" content="#3296C8">
    <title>roboquant - Domain Model</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="/img/favicon.png" />
    <!-- Font awesome icons-->
    <link href="/css/asciidoctor.css" rel="stylesheet" />
    <link href="/css/rouge_github.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/v4-shims.css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/css/styles.css" rel="stylesheet" />
</head>
    <body class="d-flex flex-column">
        <main class="flex-shrink-0">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/documentation.html">Documentation</a></li>
                <li class="nav-item"><a class="nav-link" href="/screenshots.html">Screenshots</a></li>
                <li class="nav-item"><a class="nav-link" href="/community.html">Community</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/neurallayer/roboquant" target="_blank">
                    <span class="icon"><i class="fa fa-github fa-1x"></i></span> GitHub
                </a></li>
            </ul>
        </div>
    </div>
</nav>
              <header class="masthead bg-primary text-white text-center">
                     <div class="container px-5 my-1">
                         <div class="row gx-5">
                            <div class="col-lg-4 mb-5 mb-lg-0">
                            </div>
                             <div class="col-lg-8">
                                 <div class="col h-100">
                                    <h1 class="font-weight-light mt-1 doc">Domain Model</h1>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </header>

            <section class="py-5">
                <div class="container px-5 my-1">
                    <div class="row gx-5">
                        <div class="col-lg-4 mb-5 mb-lg-0">
 <h3 class="navbar-brand">Content</h3>
 <nav id="sidebar" class="navbar fixed-left sticky-top">
    <ul class="list-unstyled">
    



               <li class="nav-item"><a href="/tutorial/index.html" class="nav-link">Welcome</a></li>



               <li class="nav-item"><a href="/tutorial/install.html" class="nav-link">Installation</a></li>



               <li class="nav-item"><a href="/tutorial/roboquant.html" class="nav-link">Roboquant</a></li>



               <li class="nav-item"><a href="/tutorial/feed.html" class="nav-link">Feed</a></li>



               <li class="nav-item"><a href="/tutorial/simbroker.html" class="nav-link">Simulated Broker</a></li>



               <li class="nav-item"><a href="/tutorial/metrics.html" class="nav-link">Metrics</a></li>






               <li class="nav-item"><a href="/tutorial/strategy.html" class="nav-link">Strategy</a></li>



               <li class="nav-item"><a href="/tutorial/policy.html" class="nav-link">Policy</a></li>



               <li class="nav-item"><a href="/tutorial/orders.html" class="nav-link">Orders</a></li>



               <li class="nav-item"><a href="/tutorial/domain.html" class="nav-link">Domain Model</a></li>



               <li class="nav-item"><a href="/tutorial/jupyter.html" class="nav-link">Jupyter Notebooks</a></li>






               <li class="nav-item"><a href="/tutorial/integration.html" class="nav-link">Integration</a></li>


    </ul>
</nav>
                         </div>
                        <div class="col-lg-8">
                            <div class="col h-100">
                                <div class="sect1">
<h2 id="_approach">Approach</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Besides components like <code>Strategy</code> and <code>Policy</code>, <em>roboquant</em> also comes with a number of domain specific classes that make it easier to implement robust trading strategies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_money">Money</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make it easier to develop solutions in a multi-currency setup, <em>roboquant</em> introduces a number of money-related domain classes: <a href="#_currency">Currency</a>, <a href="#_amount">Amount</a>, <a href="#_wallet">Wallet</a> and <a href="#_exchangerates">ExchangeRates</a> that will help.</p>
</div>
<div class="sect2">
<h3 id="_currency">Currency</h3>
<div class="paragraph">
<p>The <em>roboquant</em> <code>Currency</code> class represents any type of currency. It follows closely the interface that comes with the standard Java Currency class, but is independent of it. The main reason is that the Java implementation doesn&#8217;t support cryptocurrencies while the <em>roboquant</em> implementation supports any type of currency.</p>
</div>
<div class="paragraph">
<p>Also, several common currencies are predefined, to make it easier to work with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="nc">Currency</span><span class="p">.</span><span class="nc">USD</span>
<span class="nc">Currency</span><span class="p">.</span><span class="nc">BTC</span>
<span class="nc">Currency</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="s">"MyCryptoCoin"</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_amount">Amount</h3>
<div class="paragraph">
<p>An amount can hold the value for a single currency. You can create a new <code>Amount</code> using the constructor. But you can also use the extension functions that are defined commonly used currencies (f.e. 120.EUR). Amounts are just like numbers immutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">val</span> <span class="py">amount1</span> <span class="p">=</span> <span class="nc">Amount</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="s">"USD"</span><span class="p">),</span> <span class="mf">100.0</span><span class="p">)</span> <span class="c1">// the most code</span>
<span class="kd">val</span> <span class="py">amount2</span> <span class="p">=</span> <span class="nc">Amount</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nc">USD</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span> <span class="c1">// less code</span>
<span class="kd">val</span> <span class="py">amount3</span> <span class="p">=</span> <span class="mi">100</span><span class="p">.</span><span class="nc">USD</span> <span class="c1">// the least code</span>

<span class="kd">val</span> <span class="py">amount4</span> <span class="p">=</span> <span class="mi">50</span><span class="p">.</span><span class="nc">USD</span> <span class="p">*</span> <span class="mi">2</span> <span class="c1">// simple calculation</span>
<span class="nf">require</span><span class="p">(</span><span class="n">amount4</span> <span class="p">==</span> <span class="n">amount3</span><span class="p">)</span>

<span class="nf">println</span><span class="p">(</span><span class="n">amount1</span><span class="p">.</span><span class="nf">formatValue</span><span class="p">())</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Amounts store their values internally as a <code>Double</code> and not a <code>BigDecimal</code>. For (simulated) trading the potential loss of precision is not an issue and the benefits are improved performance and lower memory consumption.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wallet">Wallet</h3>
<div class="paragraph">
<p>A <code>Wallet</code> can hold amounts of multiple currencies at the same time. You can create a new <code>Wallet</code> by using its constructor, or by adding multiple amounts together. You can also deposit and withdraw amounts in a wallet. A <code>Wallet</code> instance is mutable.</p>
</div>
<div class="paragraph">
<p>There is an important difference between <code>deposit</code> method and using the <code>+ operator</code>. The <code>deposit</code> method will modify the existing instance while the <code>+ operator</code> will return a new wallet instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">val</span> <span class="py">wallet1</span> <span class="p">=</span> <span class="nc">Wallet</span><span class="p">(</span><span class="mi">100</span><span class="p">.</span><span class="nc">EUR</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="nc">USD</span><span class="p">)</span>
<span class="n">wallet1</span><span class="p">.</span><span class="nf">deposit</span><span class="p">(</span><span class="mi">200</span><span class="p">.</span><span class="nc">GBP</span><span class="p">)</span>
<span class="n">wallet1</span><span class="p">.</span><span class="nf">withdraw</span><span class="p">(</span><span class="mi">1000</span><span class="p">.</span><span class="nc">JPY</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">wallet2</span> <span class="p">=</span> <span class="mi">20</span><span class="p">.</span><span class="nc">EUR</span> <span class="p">-</span> <span class="mi">1000</span><span class="p">.</span><span class="nc">JPY</span> <span class="p">+</span> <span class="mi">100</span><span class="p">.</span><span class="nc">GBP</span>
<span class="kd">val</span> <span class="py">wallet3</span> <span class="p">=</span> <span class="mf">0.02</span><span class="p">.</span><span class="nc">BTC</span> <span class="p">+</span> <span class="mi">100</span><span class="p">.</span><span class="nc">USDT</span> <span class="p">+</span> <span class="mf">0.1</span><span class="p">.</span><span class="nc">ETH</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you add two amounts together you&#8217;ll always get a new <code>Wallet</code> instance back, even if the two amounts have the same currency.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exchangerates">ExchangeRates</h3>
<div class="paragraph">
<p><code>ExchangeRates</code> is an interface that supports the conversion of an amount from one currency to another one. Although you can invoke the API of an implementation directly, typically you would use the <code>convert</code> method of an <code>Amount</code> or <code>Wallet</code> instance.</p>
</div>
<div class="paragraph">
<p>The <code>Config.exchangeRates</code> property is used by the components to perform the actual conversion. So you can change this property and all code from now on will use this new implementation.</p>
</div>
<div class="paragraph">
<p>The <code>ExchangeRates</code> interface also supports different rates at different moments in time, but it depends on the actual implementation if the provided time parameter is taken into consideration. One of the implementations that comes out of the box with <em>roboquant</em>, is the <code>ECBExchangeRates</code> which contains daily exchange rates for most fiat currencies from the year 2000 onwards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="c1">// Load the exchange rates as published by the ECB (European Central Bank)</span>
<span class="nc">Config</span><span class="p">.</span><span class="n">exchangeRates</span> <span class="p">=</span> <span class="nc">ECBExchangeRates</span><span class="p">.</span><span class="nf">fromWeb</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">amountEUR</span> <span class="p">=</span> <span class="mi">20</span><span class="p">.</span><span class="nc">EUR</span>
<span class="kd">val</span> <span class="py">amountUSD</span> <span class="p">=</span> <span class="n">amountEUR</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nc">USD</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">wallet</span> <span class="p">=</span> <span class="mi">20</span><span class="p">.</span><span class="nc">USD</span> <span class="p">+</span> <span class="mi">1000</span><span class="p">.</span><span class="nc">JPY</span>

<span class="c1">// Convert wallet based on today's exchange rates</span>
<span class="kd">val</span> <span class="py">amountGBP1</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nc">GBP</span><span class="p">)</span>

<span class="c1">// Convert wallet based on two years ago exchange rates</span>
<span class="kd">val</span> <span class="py">time</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="p">-</span> <span class="mi">2</span><span class="p">.</span><span class="n">years</span>
<span class="kd">val</span> <span class="py">amountGBP2</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">convert</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nc">GBP</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
<span class="nf">require</span><span class="p">(</span><span class="n">amountGBP1</span> <span class="p">!=</span> <span class="n">amountGBP2</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_time">Time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make it easier to trade in a multi-regions, <em>roboquant</em> introduces a number of domain classes: <a href="#_timeline">Timeline</a>, <a href="#_timeframe">Timeframe</a>, <a href="#_zonedperiod">ZonedPeriod</a>.</p>
</div>
<div class="paragraph">
<p>Internally all time in stored in <code>Instant</code> type and so can always be easily compared, regardless from which timezone the information originated from. The <code>Event</code> for example exposes its time attribute as an <code>Instant</code>.</p>
</div>
<div class="sect2">
<h3 id="_timeline">Timeline</h3>
<div class="paragraph">
<p>Timeline is just a list of <code>Instant</code> instances in chronological order. For example a historical feed has a timeline, which represents all the moments in time that the feed has data available. A timeline has zero or more elements, but is always finite.</p>
</div>
</div>
<div class="sect2">
<h3 id="_timeframe">Timeframe</h3>
<div class="paragraph">
<p><code>Timeframe</code> represents a period of time with a start-time (inclusive) and an end-time (exclusive).</p>
</div>
<div class="paragraph">
<p>It is used throughout <em>roboquant</em>, but one particular use-case is that you can restrict a <code>run</code> to a particular timeframe. So instead of one large run over all the events in a <code>Feed</code>, you can have multiple smaller runs. The <code>Timeframe</code> has several helper methods that makes it easier to split a timeframe into smaller parts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">val</span> <span class="py">amount1</span> <span class="p">=</span> <span class="nc">Amount</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="s">"USD"</span><span class="p">),</span> <span class="mf">100.0</span><span class="p">)</span> <span class="c1">// the most code</span>
<span class="kd">val</span> <span class="py">amount2</span> <span class="p">=</span> <span class="nc">Amount</span><span class="p">(</span><span class="nc">Currency</span><span class="p">.</span><span class="nc">USD</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span> <span class="c1">// less code</span>
<span class="kd">val</span> <span class="py">amount3</span> <span class="p">=</span> <span class="mi">100</span><span class="p">.</span><span class="nc">USD</span> <span class="c1">// the least code</span>

<span class="kd">val</span> <span class="py">amount4</span> <span class="p">=</span> <span class="mi">50</span><span class="p">.</span><span class="nc">USD</span> <span class="p">*</span> <span class="mi">2</span> <span class="c1">// simple calculation</span>
<span class="nf">require</span><span class="p">(</span><span class="n">amount4</span> <span class="p">==</span> <span class="n">amount3</span><span class="p">)</span>

<span class="nf">println</span><span class="p">(</span><span class="n">amount1</span><span class="p">.</span><span class="nf">formatValue</span><span class="p">())</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zonedperiod">ZonedPeriod</h3>
<div class="paragraph">
<p>When dealing with time duration, there are actual two types of duration in Java/Kotlin:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Period</code> which you use for days and longer and is timezone sensitive</p>
</li>
<li>
<p><code>Duration</code> which you use for days and shorted and is not timezone sensitive</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The ZonedPeriod in <em>roboquant</em> makes this a single implementation.</p>
</div>
</div>
</div>
</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

<footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto"><div class="small m-0 text-white">Copyright &copy; roboquant.org 2021</div></div>
            <div class="col-auto">
                <a class="link-light small" href="/community.html">Contact</a>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>

<script >
    window.onload = function() {
        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }
        var clipboard = new ClipboardJS('.clipboard', {
           target: function(b) {
                var p = b.parentNode;
                if (p.className.includes("highlight")) {
                    var elems = p.getElementsByTagName("code");
                    if (elems.length > 0)
                        return elems[0];
                }
                return p.childNodes[0];
            }
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>

    </body>
</html>
